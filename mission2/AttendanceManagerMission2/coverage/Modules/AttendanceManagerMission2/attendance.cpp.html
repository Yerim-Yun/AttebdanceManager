<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>attendance.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;
#include &lt;vector&gt;
#include &lt;map&gt;
#include &lt;algorithm&gt;
#include "gmock/gmock.h"
#include "grade.h"
#include "policy.h"
#include "player.h"

using namespace testing;
using namespace std;

class AttendanceManager {
private:
	map&lt;string, Player&gt; players;
	vector&lt;string&gt; playerNames;
	vector&lt;IPolicy*&gt; policies;
public:
	DayOfWeek getDayOfWeek(const string&amp; day) {
		if (day == "monday") return MONDAY;
		if (day == "tuesday") return TUESDAY;
		if (day == "wednesday") return WEDNESDAY;
		if (day == "thursday") return THURSDAY;
		if (day == "friday") return FRIDAY;
		if (day == "saturday") return SATURDAY;
		if (day == "sunday") return SUNDAY;
		return DAY_COUNT;
	}

	bool hasPlayer(const string&amp; name) const {
		return players.count(name) &gt; 0;
	}

	void processFile(const std::string&amp; filename) {
		ifstream fin(filename);
		string name, dayStr;
		while (fin &gt;&gt; name &gt;&gt; dayStr) {
			if (!hasPlayer(name)) {
				playerNames.push_back(name);
				players.emplace(name, Player(name));
			}

			// count attendance
			DayOfWeek day = getDayOfWeek(dayStr);
			players.at(name).addAttendance(day);
		}
	}

	void addPolicy(IPolicy* policy) {
		policies.push_back(policy);
	}

	void applyPolicies()
	{
		for (auto&amp; pair : players) {
			Player&amp; player = pair.second;
			for(auto&amp; policy : policies) {
				policy-&gt;apply(player);
			}
		}
	}

	void printPlayerData()
	{
		for (const auto&amp; name : playerNames) {
			Player&amp; player = players.at(name);

			cout &lt;&lt; "NAME : " &lt;&lt; player.getName() &lt;&lt; ", ";
			cout &lt;&lt; "POINT : " &lt;&lt; player.getPoints() &lt;&lt; ", ";
			cout &lt;&lt; "GRADE : " &lt;&lt; player.getGradeName() &lt;&lt; "\n";
		}
	}

	bool isRemovedPlayer(Player&amp; player)
	{
		return (player.getGradeName() != "GOLD" &amp;&amp; player.getGradeName() != "SILVER" &amp;&amp;
			player.getAttendanceCnt(WEDNESDAY) == 0 &amp;&amp;
			player.getAttendanceCnt(SATURDAY) == 0 &amp;&amp;
			player.getAttendanceCnt(SUNDAY) == 0);
	}

	void printRemovedPlayer()
	{
		std::cout &lt;&lt; "\n";
		std::cout &lt;&lt; "Removed player\n";
		std::cout &lt;&lt; "==============\n";
		for (auto&amp; pair : players) {
			Player&amp; player = pair.second;
			if (isRemovedPlayer(player)) {
				std::cout &lt;&lt; player.getName() &lt;&lt; "\n";
			}
		}
	}
};

<span style = "background-color:#dfd">int main() {</span>
#ifdef _DEBUG
<span style = "background-color:#dfd">	::testing::InitGoogleTest();
	return RUN_ALL_TESTS();</span>
#else
	AttendanceManager manager;
	vector&lt;IGrade*&gt; grades = {
	new NormalGrade(),
	new SilverGrade(),
	new GoldGrade(),
	};

	manager.processFile("attendance_weekday_500.txt");

	manager.addPolicy(new DayPointPolicy());
	manager.addPolicy(new BonusPointPolicy());
	manager.addPolicy(new GradePolicy(grades));

	manager.applyPolicies();
	manager.printPlayerData();
	manager.printRemovedPlayer();
#endif
<span style = "background-color:#dfd">}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>